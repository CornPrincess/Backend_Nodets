# Kafka 知识点

## 消息

kafka 的数据单元称为消息，消息由字节数组组成，可以理解为数据库中的一行记录

消息是分批次写入kafka 的，这样可以提高效率，如果一条一条传，会造成大量的网络开销。这其实是在网络开销和单个消息的传输时间上的 trade off

## 模式：schema

kafka 消息只是字节数组，有人建议用额外的结构来定义消息内容，让他们更易于理解，JSON和XML简单医用，但是缺乏强类型处理能力， 许多开发者喜欢使用 Apache Avro

## 主题和分区

kafka 的**消息通过主题来进行分类**，主题好比是数据库的表，或者文件系统中的文件夹

主**题可以分为若干个分区，一个分区就是一个提交日志**，消息以**追加**的方式写入分区，**然后以FIFO 的顺序读取。**

注意：

- 一般一个主题会分为多个分区，所以**无法保证整个主题的顺序，但是可以保证单个分区内的顺序**
- 分区可以分布在不同的服务器上，**以此来提供比单个服务器更强大的性能**
- 人们把一个主题看成一个流，即 kafka stream，**流是一组从生产者移动到消费者的数据**

## 生产者和消费者

kafka 的客户端就是 kafka 系统的用户，其中分为两个基本类型：生产者和消费者。

除此之外还有高级客户端API——用户数据集成的 Kafka Connect API和用于流式处理的 Kafka Streams

### 生产者

一个消息会被发布到一个特定的主题上，生产者在默认情况下把消息均衡的分布到主题的**所有分区**上，而并不关心特定消息会被写到哪个分区。不过，在某些情况下，**生产者会把消息直接写到指定的分区，这通常用消息建和分区器来实现。分区器为键生成一个散列值，并将其映射到指定的分区上，这样可以保证含有同一个键的消息会被写到同一个分区上**，生产者也可以自定义分区器，根据不同的业务规则将消息映射到分区。

### 消费者

消费者订阅一个或多个主题，并按照消息生成的顺序读取他们。消费者通过检查消息的**偏移量offset**来区分已经读取过的消息，每个消息的 offset 都是唯一的，消费者把每个分区最后读取的消息偏移量保存在 Zookeeper 或 kafka上，**如果消费者关闭或重启，它的读取状态不会丢失。**

消费者是消费者group的一部分，也就是说，会有**一个或多个消费者共同读取一个主题**。**群组保证每个分区只能被一个消费者使用，但是一个消费者可以订阅多个主题，即一个主题分区只能对应一个消费者**。

消费者与分区之间的映射通常被称为消费者对分区的**所有权关系。**

## broker 和 集群

一个独立的 Kafka 服务器被称为 broker

broker 接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。

broker 为
