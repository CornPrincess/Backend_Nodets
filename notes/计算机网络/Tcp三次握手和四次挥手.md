# Tcp

## 三次握手

三次握手（Three-way Handshake）其实就是指建立一个TCP连接时，需要客户端和服务器总共发送3个包。进行三次握手的主要作用就是为了**确认双方的接收能力和发送能力是否正常**、**指定自己的初始化序列号为后面的可靠性传送做准备。**

实质上：

- 链接服务器指定端口
- 建立Tcp链接
- 同步链接双方的序列号和确认号
- 交换TCP窗口大小信息

为什么要三次握手

- 第一次握手：服务端得出结论：客户端的发送能力、服务端的接受能力时正常的
- 第二次握手：
  - 客户端得出结论：服务端的 发送，接受是正常的，客户端的发送接收是正常的
  - 服务端得出结论：服务器发送接受正常，**客户端发送正常，不能确认客户端是否接受正常**
- 第三次握手：**服务端确认，客户端发送接收都正常**

![image-20201207183703239](/Users/zhoutianbin/Library/Application Support/typora-user-images/image-20201207183703239.png)

## 四次挥手

终止一个连接要经过四次挥手（也有将四次挥手叫做四次握手的）。这由TCP的半关闭（half-close）造成的。

所谓的**半关闭**，**其实就是TCP提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力。**

### 为什么需要四次挥手

主要因为，在断开链接是，服务端收到客户端的第一次握手，此时不能立即关闭socket，所以只能先发一个ACK表示我收到了，此时进入半链接状态，等到服务端将所有的报文都发送完毕之后，再发送FIN宝沃

### 2MSL等待状态

