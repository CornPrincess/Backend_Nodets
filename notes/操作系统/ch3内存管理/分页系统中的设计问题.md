# 分页系统中的设计问题

## 局部分配策略与全局分配策略

与页面置换有关的是，发送缺页故障时，置换本进程的页面还是其他进程的页面，即怎样在相互竞争的可运行程序之间分配内存。

- [ ] 补图

图b算法为局部（local）页面置换算法，图c为全局（global）页面置换算法，局部算法可以有效地为每个进程分配固定的内存片段，全局算法在可运行的进程之间动态地分配页框。因此分配给各个进程的页框数是随时间变化的。

全局算法在可运行进程之间动态地分配页框，因此分配给各个进程的页框数是随时间变化的，全局算法在通常情况下工作得比局部算法好。若使用局部算法，即使有大量的空闲页框存在，工作集的增长也会导致颠簸（ thrashing ），如果工作集变小，局部算法又会浪费内存。

可以使用为进程分配页框的算法，其中一种方法是定期确定进程运行的数目并为他们分配等额的份额。可以按照进程的大小比例来分配相应数目的页面，对每个进程规定一个最小的页框数，这样无论多么小的进程都能运行。

如果使用全局算法，根据进程的大小按比例分配页面也是可能的，**但是该分配必须在程序运行时动态更新，这里的方法用到了（Page Fault Frequency PFF）缺页中断率算法。它指出了何时增加或减少分配给一个进程的页面，但却完全没有说明在发送缺页中断时应该替换掉哪一个页面，它仅仅控制分配集的大小。**

缺页中断率会随着分配的页面增加而降低，这是**PFF**背后的假定。

**值得注意的是，一些页面置换算法既适用于局部置换算法，有适用于全局置换算法，如FIFO，LRU。另一方面，对于其他的页面置换算法，只有采取局部策略才有意义，如工作集和WSClock算法，是针对某些特定进程的而且必须应用在这些进程的上下文中。**

![local versus global replacement](https://blog-1300663127.cos.ap-shanghai.myqcloud.com/BackEnd_Notes/operating%20system/local%20versus%20global%20page%20replacement.png)

## 负载控制

即使是使用了最优页面置换算法并对进程采用理想的全局页框分配，系统也可能产生颠簸。事实上，一旦所有进程的组合工作集超出了内存容量，就可能发生颠簸。该现象的症状之一就是如PFF算法所指出的，一些进程需要更多的内存，但是没有进程需要更少的内存，在这种情况下，没有方法能够在不影响其他进程的情况下满足那些需要更多内存的进程的需要。唯一现实的方案就是暂时从内存中去掉一些进程。

减少竞争内存的进程数的一个好方法是将一部分进程交换到次哦安，并释放他们所占有的所有页面。例如，一个进程可以被交换到磁盘，而它的页框可以被其他处于颠簸状态的进程分享，如果颠簸停止，系统能够这样运行一段时间，如果颠簸没有停止，需要继续将其他进程交换出去，直到颠簸结束。因此，即使是使用分页，交换也是需要的，只是现在交换是用来减少对内存潜在的需求，而不是收回它的页面。

将进程交换出去以减轻内存需要的压力是借用了两级调度（two level scheduling）的思想，在此过程中，一些进程被放到磁盘，此时用一个短期的调度程序来调度剩余的进程。很明显，这两种思路可以被组合起来，将恰好足够的进程交换出去以获取可接受的缺页中断率，一些进程被周期性地从磁盘掉入，而其他一些则周期性的交换到磁盘。

不过，另一个需要考虑的因素是多道程序设计的道数，当内存中的进程数太低时，CPU可能在很长的时间处于空闲状态，考虑到该因素，在决定交换出哪个程序时不光要考虑进程大小和分页率，还要考虑它的特性（CPU密集型还是IO密集型）（CPU bound， IO bound）

## 页面大小

